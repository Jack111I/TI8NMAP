<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root { --bg: #0d1117; --acc: #58a6ff; --brd: #30363d; }
        body { background: var(--bg); color: #c9d1d9; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        .sidebar { background: #161b22; border-right: 1px solid var(--brd); height: 100vh; padding: 15px; }
        #canvas { background: #010409; height: 70vh; }
        .right-hub { background: #161b22; border-left: 1px solid var(--brd); height: 100vh; padding: 15px; overflow-y: auto; }
        #console { height: 30vh; background: #000; border-top: 1px solid var(--brd); padding: 10px; font-size: 11px; overflow-y: auto; color: #8b949e; }
        .port-tag { background: #21262d; border: 1px solid var(--acc); padding: 2px 6px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block; }
    </style>
</head>
<body>
    <div class="row g-0">
        <div class="col-md-2 sidebar text-center">
            <h6 class="text-acc fw-bold mb-4">TI8NMAP</h6>
            <input id="target" class="form-control form-control-sm bg-dark text-white mb-3" placeholder="192.168.0.0/24">
            <button onclick="launch()" class="btn btn-primary btn-sm w-100 mb-2">ENGAGE MAP</button>
            <button onclick="socket.emit('scan_wifi'); showWiFi()" class="btn btn-outline-success btn-sm w-100">ðŸ“¡ WIFI RANGE</button>
        </div>

        <div class="col-md-7">
            <div id="canvas"></div>
            <div id="console">>> INITIALIZING COMMAND...</div>
        </div>

        <div class="col-md-3 right-hub">
            <div id="intel-view">
                <h6 class="text-acc small border-bottom pb-2">NODE INTEL</h6>
                <div id="intel-body" class="small mt-3">Select a node to inspect.</div>
                <div id="attack-btns" class="mt-4" style="display:none">
                    <button onclick="attack('vuln')" class="btn btn-outline-warning btn-sm w-100 mb-2">VULN SCAN</button>
                    <button onclick="attack('brute')" class="btn btn-outline-danger btn-sm w-100">BRUTE SSH</button>
                </div>
                <div id="report" class="mt-4 small text-info" style="white-space: pre-wrap; font-family: monospace;"></div>
            </div>
            <div id="wifi-view" style="display:none">
                <h6 class="text-success small border-bottom pb-2">WIFI SPECTRUM</h6>
                <div id="wifi-body" class="small mt-3"></div>
                <button onclick="hideWiFi()" class="btn btn-link btn-sm text-secondary">Back</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        let nodes = [{ id: "C2_MASTER", group: 0 }];
        let links = [];
        let hostCache = {};
        let activeIP = null;

        const svg = d3.select("#canvas").append("svg").attr("width","100%").attr("height","100%").call(d3.zoom().on("zoom", (e) => g.attr("transform", e.transform)));
        const g = svg.append("g");
        const sim = d3.forceSimulation(nodes).force("link", d3.forceLink(links).id(d => d.id).distance(110)).force("charge", d3.forceManyBody().strength(-350)).force("center", d3.forceCenter(window.innerWidth*0.35, 300));

        function draw() {
            g.selectAll("*").remove();
            const link = g.append("g").selectAll("line").data(links).enter().append("line").attr("stroke", "#30363d");
            const node = g.append("g").selectAll("circle").data(nodes).enter().append("circle")
                .attr("r", d => d.id === "C2_MASTER" ? 11 : 8).attr("fill", d => d.id === "C2_MASTER" ? "#58a6ff" : "#238636")
                .on("click", (e,d) => inspect(d.id));
            sim.nodes(nodes); sim.force("link").links(links); sim.alpha(1).restart();
            sim.on("tick", () => { link.attr("x1", d=>d.source.x).attr("y1", d=>d.source.y).attr("x2", d=>d.target.x).attr("y2", d=>d.target.y); node.attr("cx", d=>d.x).attr("cy", d=>d.y); });
        }

        function inspect(id) {
            if(id === "C2_MASTER") return;
            activeIP = id;
            document.getElementById('wifi-view').style.display = 'none';
            document.getElementById('intel-view').style.display = 'block';
            document.getElementById('attack-btns').style.display = 'block';
            const body = document.getElementById('intel-body');
            if(hostCache[id]) {
                const h = hostCache[id];
                let ports = ""; for(let p in h.ports) { ports += `<span class='port-tag'>${p}</span>`; }
                body.innerHTML = `<b>IP:</b> ${h.ip}<br><b>OS:</b> ${h.os}<br><b>HW:</b> ${h.vendor}<hr>${ports}`;
            } else { body.innerHTML = "Intercepting node data..."; }
        }

        function showWiFi() { document.getElementById('intel-view').style.display = 'none'; document.getElementById('wifi-view').style.display = 'block'; }
        function hideWiFi() { document.getElementById('intel-view').style.display = 'block'; document.getElementById('wifi-view').style.display = 'none'; }
        
        function attack(type) { socket.emit('attack_node', { ip: activeIP, type: type }); }
        socket.on('attack_results', d => { document.getElementById('report').innerText = ">>> MISSION REPORT ["+d.ip+"]:\n" + d.data; });
        socket.on('wifi_data', d => { document.getElementById('wifi-body').innerHTML = `<pre style='color:#3fb950; font-size:9px'>${d.raw}</pre>`; });
        socket.on('new_node', d => { if(!nodes.find(n => n.id === d.id)) { nodes.push({id: d.id}); links.push({source:"C2_MASTER", target:d.id}); draw(); }});
        socket.on('intel_update', d => { hostCache[d.ip] = d; });
        socket.on('log', d => { const c = document.getElementById('console'); c.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${d.msg}</div>`; c.scrollTop = c.scrollHeight; });

        function launch() { socket.emit('start_mission', { target: document.getElementById('target').value }); }
        draw();
    </script>
</body>

</html>
